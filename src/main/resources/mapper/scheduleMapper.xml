<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bitcamp.semiproj.dao.ScheduleMapper">
    
    <select id="selectAll" resultType="ScheduleDto">
	select shw.*, m.title, s.name as screen_name
	from theater as t
	join movie as m
	join screen as s
	join show_schedule as shw
	on shw.theaterID = t.theaterID and shw.screenID = s.screenID and shw.movieID = m.movieID;
    </select>
       
    <select id="selectScheduleInfo" parameterType="Map" resultMap="ScheduleDtoMap">
		SELECT *
		FROM movie AS m
		JOIN theater as t
		JOIN screen AS s
		JOIN screen_class as c
		JOIN show_schedule as shw
		JOIN screen_seat as seat
			ON shw.theaterID = t.theaterID AND shw.screenID = s.screenID AND shw.movieID = m.movieID AND c.classID = s.classID AND seat.screenID = s.screenID
		WHERE shw.screen_date=#{date} and t.theaterID=#{theaterID} and shw.movieID=#{movieID}
		ORDER BY shw.screen_date ASC, shw.start_time ASC, shw.start_time ASC;
    </select>
    
   <resultMap id="ScheduleDtoMap" type="ScheduleDto">
    	<result property="scheduleID" column="scheduleID"/>
    	<result property="theaterID" column="theaterID"/>
    	<result property="screenID" column="screenID"/>
    	<result property="movieID" column="movieID"/>
    	<result property="screen_date" column="screen_date"/>
    	<result property="start_time" column="start_time"/>
    	<result property="end_time" column="end_time"/>
	    	<association property="screenDto" javaType="ScreenDto">
	    	    	<result property="screenID" column="screenID"/>
	    	    	<result property="theaterID" column="theaterID"/>
	    	    	<result property="screen_name" column="screen_name"/>
		    	    	<association property="screenClassDto" javaType="ScreenClassDto">
		    	    		<result property="classID" column="classID"/>
		    	    		<result property="class_type" column="class_type"/>
								<!-- <association property="priceDto" javaType="PriceDto">
		    	    				<result property="priceID" column="priceID"/>
		    	    				<result property="classID" column="classID"/>
		    	    				<result property="age_group" column="age_group"/>
		    	    				<result property="price" column="price"/>
		    					</association> -->
		    			</association>
		    			<association property="seatDto" javaType="ScreenSeatDto">
		    	    		<result property="screenID" column="screenID"/>
		    	    		<result property="row_qty" column="row_qty"/>
		    	    		<result property="column_qty" column="column_qty"/>
		    			</association>
	    	</association>
    </resultMap>
    
   
</mapper>